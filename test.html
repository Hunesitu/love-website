<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APIæµ‹è¯•é¡µé¢</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #ffecd2, #fcb69f);
            min-height: 100vh;
        }
        .test-container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            color: #e91e63;
            margin-bottom: 30px;
        }
        .test-button {
            background: linear-gradient(45deg, #e91e63, #9c27b0);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
            transition: transform 0.3s ease;
        }
        .test-button:hover {
            transform: translateY(-2px);
        }
        .test-results {
            margin-top: 20px;
            padding: 20px;
            background: #f5f5f5;
            border-radius: 10px;
            white-space: pre-wrap;
            font-family: monospace;
            max-height: 400px;
            overflow-y: auto;
        }
        .success { color: #4caf50; }
        .error { color: #f44336; }
        .info { color: #2196f3; }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="header">
            <h1>ğŸ’– çˆ±æƒ…ç½‘ç«™ API æµ‹è¯•</h1>
            <p>æµ‹è¯•å‰åç«¯é›†æˆåŠŸèƒ½</p>
        </div>

        <div style="text-align: center;">
            <button class="test-button" onclick="runAPITest()">ğŸ§ª è¿è¡Œ API æµ‹è¯•</button>
            <button class="test-button" onclick="openMainSite()">ğŸ’• æ‰“å¼€çˆ±æƒ…ç½‘ç«™</button>
            <button class="test-button" onclick="clearResults()">ğŸ§¹ æ¸…ç†ç»“æœ</button>
        </div>

        <div id="testResults" class="test-results" style="display: none;">
            ç­‰å¾…æµ‹è¯•ç»“æœ...
        </div>

        <div style="margin-top: 30px; padding: 20px; background: #fff3e0; border-radius: 10px;">
            <h3>ğŸ“‹ æµ‹è¯•è¯´æ˜</h3>
            <ul>
                <li><strong>åç«¯æœåŠ¡:</strong> http://localhost:3001</li>
                <li><strong>å‰ç«¯æœåŠ¡:</strong> http://localhost:8080</li>
                <li><strong>é»˜è®¤å¯†ç :</strong> love2024</li>
            </ul>

            <h3>ğŸ”§ æµ‹è¯•å†…å®¹</h3>
            <ul>
                <li>âœ… APIå¥åº·æ£€æŸ¥</li>
                <li>ğŸ” ç”¨æˆ·ç™»å½•è®¤è¯</li>
                <li>ğŸ“– æ—¥è®°åŠŸèƒ½æµ‹è¯•</li>
                <li>âœ… å¾…åŠäº‹é¡¹åŠŸèƒ½</li>
                <li>ğŸ’• æ‚„æ‚„è¯åŠŸèƒ½</li>
            </ul>
        </div>
    </div>

    <script>
        function log(message, type = 'info') {
            const results = document.getElementById('testResults');
            const timestamp = new Date().toLocaleTimeString();
            const colorClass = type === 'success' ? 'success' : type === 'error' ? 'error' : 'info';
            results.innerHTML += `<span class="${colorClass}">[${timestamp}] ${message}</span>\n`;
            results.scrollTop = results.scrollHeight;
        }

        async function runAPITest() {
            const results = document.getElementById('testResults');
            results.style.display = 'block';
            results.innerHTML = '';

            log('ğŸ§ª å¼€å§‹ API é›†æˆæµ‹è¯•...', 'info');

            try {
                // 1. æµ‹è¯•å¥åº·æ£€æŸ¥
                log('\n1. æµ‹è¯•å¥åº·æ£€æŸ¥...', 'info');
                const healthResponse = await fetch('http://localhost:3001/api/health');
                const healthData = await healthResponse.json();
                log(`âœ… å¥åº·æ£€æŸ¥é€šè¿‡: ${healthData.message}`, 'success');

                // 2. æµ‹è¯•ç™»å½•
                log('\n2. æµ‹è¯•ç™»å½•...', 'info');
                const loginResponse = await fetch('http://localhost:3001/api/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ password: 'love2024' })
                });
                const loginData = await loginResponse.json();

                if (loginData.success) {
                    log(`âœ… ç™»å½•æˆåŠŸ: ${loginData.user.person1Name} â¤ï¸ ${loginData.user.person2Name}`, 'success');

                    const token = loginData.token;
                    const headers = {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    };

                    // 3. æµ‹è¯•åˆ›å»ºæ—¥è®°
                    log('\n3. æµ‹è¯•åˆ›å»ºæ—¥è®°...', 'info');
                    const diaryResponse = await fetch('http://localhost:3001/api/diaries', {
                        method: 'POST',
                        headers,
                        body: JSON.stringify({
                            title: 'ç¬¬ä¸€ç¯‡æµ‹è¯•æ—¥è®°',
                            content: 'ä»Šå¤©æˆ‘ä»¬æµ‹è¯•äº†çˆ±æƒ…ç½‘ç«™çš„APIåŠŸèƒ½ï¼Œä¸€åˆ‡éƒ½å¾ˆé¡ºåˆ©ï¼ğŸ’•',
                            mood: 'happy',
                            weather: 'sunny',
                            date: new Date().toISOString().split('T')[0]
                        })
                    });
                    const diaryData = await diaryResponse.json();
                    if (diaryData.success) {
                        log(`âœ… æ—¥è®°åˆ›å»ºæˆåŠŸ: ${diaryData.data.title}`, 'success');
                    }

                    // 4. æµ‹è¯•è·å–æ—¥è®°åˆ—è¡¨
                    log('\n4. æµ‹è¯•è·å–æ—¥è®°åˆ—è¡¨...', 'info');
                    const getDiariesResponse = await fetch('http://localhost:3001/api/diaries', {
                        headers
                    });
                    const getDiariesData = await getDiariesResponse.json();
                    if (getDiariesData.success) {
                        log(`âœ… æ—¥è®°åˆ—è¡¨è·å–æˆåŠŸï¼Œå…± ${getDiariesData.data.length} ç¯‡æ—¥è®°`, 'success');
                    }

                    // 5. æµ‹è¯•åˆ›å»ºå¾…åŠäº‹é¡¹
                    log('\n5. æµ‹è¯•åˆ›å»ºå¾…åŠäº‹é¡¹...', 'info');
                    const todoResponse = await fetch('http://localhost:3001/api/todos', {
                        method: 'POST',
                        headers,
                        body: JSON.stringify({
                            content: 'ä¸€èµ·å»çœ‹ç”µå½± ğŸ¬',
                            priority: 'high',
                            category: 'date'
                        })
                    });
                    const todoData = await todoResponse.json();
                    if (todoData.success) {
                        log(`âœ… å¾…åŠäº‹é¡¹åˆ›å»ºæˆåŠŸ: ${todoData.data.content}`, 'success');
                    }

                    // 6. æµ‹è¯•åˆ›å»ºæ‚„æ‚„è¯
                    log('\n6. æµ‹è¯•åˆ›å»ºæ‚„æ‚„è¯...', 'info');
                    const messageResponse = await fetch('http://localhost:3001/api/messages', {
                        method: 'POST',
                        headers,
                        body: JSON.stringify({
                            content: 'æˆ‘çˆ±ä½ ï¼Œä»Šå¤©çš„APIæµ‹è¯•çœŸæˆåŠŸï¼ğŸ’–',
                            author: 'åŒ…èƒ¡å‘¢æ–¯å›¾',
                            isSpecial: true
                        })
                    });
                    const messageData = await messageResponse.json();
                    if (messageData.success) {
                        log(`âœ… æ‚„æ‚„è¯åˆ›å»ºæˆåŠŸ: ${messageData.data.content}`, 'success');
                    }

                    log('\nğŸ‰ æ‰€æœ‰APIæµ‹è¯•å®Œæˆï¼', 'success');
                    log('\nğŸ“‹ æµ‹è¯•æ€»ç»“:', 'info');
                    log('   âœ… ç”¨æˆ·è®¤è¯ç³»ç»Ÿæ­£å¸¸', 'success');
                    log('   âœ… æ—¥è®°åŠŸèƒ½æ­£å¸¸', 'success');
                    log('   âœ… å¾…åŠäº‹é¡¹åŠŸèƒ½æ­£å¸¸', 'success');
                    log('   âœ… æ‚„æ‚„è¯åŠŸèƒ½æ­£å¸¸', 'success');
                    log('\nğŸ’– çˆ±æƒ…ç½‘ç«™åç«¯APIè¿è¡Œå®Œç¾ï¼', 'success');

                } else {
                    log(`âŒ ç™»å½•å¤±è´¥: ${loginData.error}`, 'error');
                }

            } catch (error) {
                log(`âŒ APIæµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                log('è¯·ç¡®ä¿åç«¯æœåŠ¡æ­£åœ¨è¿è¡Œ: http://localhost:3001', 'error');
            }
        }

        function openMainSite() {
            window.open('http://localhost:8080', '_blank');
        }

        function clearResults() {
            document.getElementById('testResults').innerHTML = '';
        }
    </script>
</body>
</html>